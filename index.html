<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- å›¾æ ‡è®¾ç½®ä¸º 1-5 -->
    <link rel="apple-touch-icon" href="https://ui-avatars.com/api/?name=1-5&background=ff3b30&color=fff&size=512&font-size=0.5&length=3">

    <title>ç¬¬1-5è¯¾ ç»¼åˆç»ƒä¹ </title>
    <style>
        :root { --primary: #007aff; --bg: #f2f2f7; --mask-bg: #d1d1d6; }
        body { font-family: -apple-system, "Helvetica Neue", sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* é¡¶éƒ¨æ§åˆ¶åŒº */
        .header { background: #fff; border-bottom: 1px solid #ddd; z-index: 10; flex-shrink: 0; display: flex; flex-direction: column;}
        .title-bar { padding: 12px; text-align: center; font-weight: bold; font-size: 1.1rem; border-bottom: 1px solid #eee;}
        .filter-bar { padding: 10px; display: flex; gap: 8px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; align-items: center;}
        
        /* å¤é€‰æ¡†æ ·å¼ */
        .filter-label { display: flex; align-items: center; background: #eee; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; transition: 0.2s; }
        .filter-label input { margin-right: 6px; }
        .filter-label.checked { background: #e3f2fd; color: #007aff; font-weight: bold; border: 1px solid #007aff; }

        .container { flex: 1; padding: 15px; overflow-y: auto; display: flex; justify-content: center; align-items: flex-start; -webkit-overflow-scrolling: touch;}
        .card { background: #fff; width: 100%; max-width: 500px; border-radius: 16px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); text-align: center; margin-bottom: 40px; position: relative;}
        
        /* è¯¾ç¨‹è§’æ ‡ */
        .lesson-badge { position: absolute; top: 10px; right: 10px; background: #ff9500; color: white; font-size: 0.7rem; padding: 3px 8px; border-radius: 4px; font-weight: bold;}
        .tag { background: #e5e5ea; color: #666; padding: 4px 10px; border-radius: 6px; font-size: 0.9rem; margin-bottom: 15px; display: inline-block; font-weight: bold;}

        /* === å¸ƒå±€ === */
        .dialogue-row { display: flex; align-items: flex-start; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .play-col { width: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-right: 10px; padding-top: 5px; }
        .play-icon { font-size: 1.4rem; color: var(--primary); cursor: pointer; background: #eef7ff; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .play-icon:active { background: #007aff; color: white; transform: scale(0.9); }
        .text-col { flex: 1; text-align: left; }
        
        /* è§’è‰²æ ‡ç­¾ */
        .role-tag { font-size: 0.7rem; font-weight: bold; color: white; padding: 2px 6px; border-radius: 4px; margin-right: 5px; vertical-align: middle; display: inline-block; margin-bottom: 4px;}
        .role-m { background-color: #5856d6; } 
        .role-f { background-color: #ff2d55; }
        .role-special { background-color: #007aff; } /* ç‰¹å®šè§’è‰² */

        /* é®æŒ¡æ¡ */
        .text-block { transition: all 0.2s; border-radius: 6px; padding: 6px 8px; cursor: pointer; display: block; margin-bottom: 6px; line-height: 1.5; border: 1px solid transparent; }
        .masked { background-color: var(--mask-bg); color: transparent !important; position: relative; border-color: transparent; user-select: none;}
        .masked::after { content: ''; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 8px; height: 8px; background: #999; border-radius: 50%; }

        .jp-text { font-size: 1.15rem; font-weight: bold; color: #000; }
        .cn-text { font-size: 0.95rem; color: #666; }
        .playing-row { background-color: #f0f9ff; border-radius: 8px; }

        /* åº•éƒ¨æ§åˆ¶æ  */
        .controls { padding: 10px 15px; background: #fff; border-top: 1px solid #ddd; flex-shrink: 0; padding-bottom: calc(10px + env(safe-area-inset-bottom));}
        .row { display: flex; gap: 8px; margin-bottom: 8px; }
        button { border: none; padding: 12px; border-radius: 10px; font-size: 0.9rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; touch-action: manipulation;}
        .btn-green { background: #34c759; color: white; width: 100%; font-size: 1rem; margin-bottom: 8px; padding: 12px;}
        .btn-blue { background: #007aff; color: white; flex: 1; }
        .btn-nav { background: #eee; color: #333; flex: 1; }
        .btn-toggle { background: #fff; border: 1px solid #ccc; color: #333; flex: 1; }
        .btn-toggle.active { background: #5ac8fa; color: white; border: none; }
        #status-bar { font-size: 10px; color: #999; text-align: center; margin-top: 2px; height: 14px;}
        
        .empty-tip { color: #999; margin-top: 50px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title-bar" id="pageTitle">ç¬¬1-5è¯¾ ç»¼åˆç»ƒä¹ </div>
        <div class="filter-bar">
            <!-- è¯¾ç¨‹ç­›é€‰å™¨ -->
            <label class="filter-label checked" onclick="toggleFilter(this, 1)">
                <input type="checkbox" checked hidden> ç¬¬1è¯¾
            </label>
            <label class="filter-label checked" onclick="toggleFilter(this, 2)">
                <input type="checkbox" checked hidden> ç¬¬2è¯¾
            </label>
            <label class="filter-label checked" onclick="toggleFilter(this, 3)">
                <input type="checkbox" checked hidden> ç¬¬3è¯¾
            </label>
            <label class="filter-label checked" onclick="toggleFilter(this, 4)">
                <input type="checkbox" checked hidden> ç¬¬4è¯¾
            </label>
            <label class="filter-label checked" onclick="toggleFilter(this, 5)">
                <input type="checkbox" checked hidden> ç¬¬5è¯¾
            </label>
        </div>
    </div>

    <div class="container">
        <div id="cardArea" class="card"></div>
    </div>

    <div class="controls">
        <div id="status-bar">å‡†å¤‡å°±ç»ª</div>
        <div class="row">
            <button class="btn-toggle" id="btnJp" onclick="toggleGlobal('jp')">å…¨æ˜¾æ—¥æ–‡</button>
            <button class="btn-toggle" id="btnCn" onclick="toggleGlobal('cn')">å…¨æ˜¾ä¸­æ–‡</button>
            <button class="btn-blue" onclick="shuffleAndReset()">ğŸ”€ æ‰“ä¹±é‡æ¥</button>
        </div>
        <div class="row">
            <button class="btn-nav" onclick="changeCard(-1)">â¬…ï¸ ä¸Šä¸€æ¡</button>
            <button class="btn-nav" onclick="changeCard(1)">ä¸‹ä¸€æ¡ â¡ï¸</button>
        </div>
    </div>

    <script>
        // ===============================================
        // å…¨é‡æ•°æ®ï¼šLesson 1 - 5
        // ===============================================
        const rawData = [
            // === ç¬¬1è¯¾ ===
            { lesson: 1, category: 'ä¾‹æ–‡ 1', lines: [{ role: 'Q', gender: 'f', jp: 'ã‚ãªãŸã¯ã€€ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã•ã‚“ã§ã™ã‹ã€‚', cn: 'ä½ æ˜¯è¿ˆå…‹Â·ç±³å‹’å…ˆç”Ÿå—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã¯ã„ã€[ã‚ãŸã—ã¯] ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã§ã™ã€‚', cn: 'â€¦æ˜¯çš„ï¼Œ[æˆ‘]æ˜¯è¿ˆå…‹Â·ç±³å‹’ã€‚' }] },
            { lesson: 1, category: 'ä¾‹æ–‡ 2', lines: [{ role: 'Q', gender: 'f', jp: 'ãƒŸãƒ©ãƒ¼ã•ã‚“ã¯ã€€å­¦ç”Ÿã§ã™ã‹ã€‚', cn: 'ç±³å‹’å…ˆç”Ÿæ˜¯å­¦ç”Ÿå—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã„ã„ãˆã€[ã‚ãŸã—ã¯] å­¦ç”Ÿã˜ã‚ƒã€€ã‚ã‚Šã¾ã›ã‚“ã€‚', cn: 'â€¦ä¸ï¼Œ[æˆ‘]ä¸æ˜¯å­¦ç”Ÿã€‚' }] },
            { lesson: 1, category: 'ä¾‹æ–‡ 3', lines: [{ role: 'Q', gender: 'f', jp: 'ãƒ¯ãƒ³ã•ã‚“ã¯ã€€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã‹ã€‚', cn: 'ç‹å…ˆç”Ÿæ˜¯å·¥ç¨‹å¸ˆå—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã„ã„ãˆã€ãƒ¯ãƒ³ã•ã‚“ã¯ã€€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã˜ã‚ƒã€€ã‚ã‚Šã¾ã›ã‚“ã€‚', cn: 'â€¦ä¸ï¼Œç‹å…ˆç”Ÿä¸æ˜¯å·¥ç¨‹å¸ˆã€‚' }] },
            { lesson: 1, category: 'ä¾‹æ–‡ 4', lines: [{ role: 'Q', gender: 'f', jp: 'ã‚ã®æ–¹ã¯ã€€ã©ãªãŸã§ã™ã‹ã€‚', cn: 'é‚£ä½æ˜¯è°ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ãƒ¯ãƒƒãƒˆã•ã‚“ã§ã™ã€‚ã•ãã‚‰å¤§å­¦ã®ã€€å…ˆç”Ÿã§ã™ã€‚', cn: 'â€¦æ˜¯ç“¦ç‰¹å…ˆç”Ÿã€‚æ¨±èŠ±å¤§å­¦çš„è€å¸ˆã€‚' }] },
            { lesson: 1, category: 'ä¾‹æ–‡ 5', lines: [{ role: 'Q', gender: 'f', jp: 'ãƒ†ãƒ¬ã‚µã¡ã‚ƒã‚“ã¯ã€€ä½•æ­³ã§ã™ã‹ã€‚', cn: 'ç‰¹è•¾èå‡ å²äº†ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦9æ­³ã§ã™ã€‚', cn: 'â€¦9å²ã€‚' }] },
            { lesson: 1, category: 'ä¼šè¯ï¼šåˆæ¬¡è§é¢', lines: [{ role: 'ä½è—¤', gender: 'f', jp: 'ãŠã¯ã‚ˆã†ã€€ã”ã–ã„ã¾ã™ã€‚', cn: 'æ—©ä¸Šå¥½ã€‚' }, { role: 'å±±ç”°', gender: 'm', jp: 'ãŠã¯ã‚ˆã†ã€€ã”ã–ã„ã¾ã™ã€‚', cn: 'æ—©ä¸Šå¥½ã€‚' }, { role: 'ä½è—¤', gender: 'f', jp: 'ã“ã¡ã‚‰ã¯ã€€ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã•ã‚“ã§ã™ã€‚', cn: 'è¿™ä½æ˜¯è¿ˆå…‹Â·ç±³å‹’å…ˆç”Ÿã€‚' }, { role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'åˆã‚ã¾ã—ã¦ã€‚', cn: 'åˆæ¬¡è§é¢ã€‚' }, { role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã§ã™ã€‚', cn: 'æˆ‘æ˜¯è¿ˆå…‹Â·ç±³å‹’ã€‚' }, { role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'ã‚¢ãƒ¡ãƒªã‚«ã‹ã‚‰ã€€æ¥ã¾ã—ãŸã€‚', cn: 'æˆ‘ä»ç¾å›½æ¥ã€‚' }, { role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'ã©ã†ãã€€ã‚ˆã‚ã—ãã€‚', cn: 'è¯·å¤šå…³ç…§ã€‚' }, { role: 'ä½è—¤', gender: 'f', jp: 'ä½è—¤ã‘ã„å­ã§ã™ã€‚ã©ã†ãã€€ã‚ˆã‚ã—ãã€‚', cn: 'æˆ‘æ˜¯ä½è—¤æƒ å­ã€‚è¯·å¤šå…³ç…§ã€‚' }]},

            // === ç¬¬2è¯¾ ===
            { lesson: 2, category: 'ä¾‹æ–‡ 1', lines: [{ role: 'Q', gender: 'f', jp: 'ã“ã‚Œã¯ ãƒœãƒ¼ãƒ«ãƒšãƒ³ã§ã™ã‹ã€‚', cn: 'è¿™æ˜¯åœ†ç ç¬”å—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã¯ã„ã€ãã†ã§ã™ã€‚', cn: 'â€¦æ˜¯çš„ï¼Œæ˜¯åœ†ç ç¬”ã€‚' }] },
            { lesson: 2, category: 'ä¾‹æ–‡ 2', lines: [{ role: 'Q', gender: 'f', jp: 'ãã‚Œã¯ ãƒãƒ¼ãƒˆã§ã™ã‹ã€‚', cn: 'é‚£æ˜¯ç¬”è®°æœ¬å—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã„ã„ãˆã€[ã“ã‚Œã¯] æ‰‹å¸³ã§ã™ã€‚', cn: 'â€¦ä¸ï¼Œ[è¿™æ˜¯] è®°äº‹æœ¬ã€‚' }] },
            { lesson: 2, category: 'ä¾‹æ–‡ 3', lines: [{ role: 'Q', gender: 'f', jp: 'ãã‚Œã¯ ä½•ã§ã™ã‹ã€‚', cn: 'é‚£æ˜¯ä»€ä¹ˆï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦[ã“ã‚Œã¯] ååˆºã§ã™ã€‚', cn: 'â€¦[è¿™æ˜¯] åç‰‡ã€‚' }] },
            { lesson: 2, category: 'ä¾‹æ–‡ 4', lines: [{ role: 'Q', gender: 'f', jp: 'ã‚ã‚Œã¯ ã ã‚Œã® ã‹ã°ã‚“ã§ã™ã‹ã€‚', cn: 'é‚£æ˜¯ä¸ªè°çš„åŒ…ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ä½è—¤ã•ã‚“ã® ã‹ã°ã‚“ã§ã™ã€‚', cn: 'â€¦æ˜¯ä½è—¤å…ˆç”Ÿ/å¥³å£«çš„åŒ…ã€‚' }] },
            { lesson: 2, category: 'ä¾‹æ–‡ 5', lines: [{ role: 'Q', gender: 'f', jp: 'ã“ã® ã‹ãã¯ ã ã‚Œã®ã§ã™ã‹ã€‚', cn: 'è¿™æŠŠé’¥åŒ™æ˜¯è°çš„ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã‚ãŸã—ã®ã§ã™ã€‚', cn: 'â€¦æ˜¯æˆ‘çš„ã€‚' }] },
            { lesson: 2, category: 'ä¼šè¯ï¼šä»ä»Šèµ·æ‰¿è’™å…³ç…§', lines: [{ role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ã“ã‚“ã«ã¡ã¯ã€‚ã‚µãƒ³ãƒˆã‚¹ã§ã™ã€‚', cn: 'ä½ å¥½ã€‚æˆ‘æ˜¯æ¡‘æ‰˜æ–¯ã€‚' }, { role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ã“ã‚Œã‹ã‚‰ ãŠä¸–è©±ã« ãªã‚Šã¾ã™ã€‚', cn: 'ä»Šåè¯·ä½ å¤šå…³ç…§ã€‚' }, { role: 'å±±ç”°', gender: 'm', jp: 'ã“ã¡ã‚‰ã“ã ã‚ˆã‚ã—ã ãŠé¡˜ã„ã—ã¾ã™ã€‚', cn: 'å“ªé‡Œå“ªé‡Œï¼Œä¹Ÿè¯·ä½ å¤šå¤šæŒ‡æ•™ã€‚' }, { role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ã‚ã®ã†ã€ã“ã‚Œã€ã‚³ãƒ¼ãƒ’ãƒ¼ã§ã™ã€‚ã©ã†ãã€‚', cn: 'é‚£ä¸ªâ€¦â€¦è¿™ç‚¹å¿ƒæ„ï¼Œæ˜¯å’–å•¡ã€‚è¯·æ”¶ä¸‹ã€‚' }]},

            // === ç¬¬3è¯¾ ===
            { lesson: 3, category: 'ç»ƒä¹  1', lines: [{ role: 'Q', gender: 'f', jp: 'ã“ã“ã¯ã€€æ–°å¤§é˜ªã§ã™ã‹ã€‚', cn: 'è¿™é‡Œæ˜¯æ–°å¤§é˜ªå—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã¯ã„ã€ãã†ã§ã™ã€‚', cn: 'â€¦æ˜¯çš„ï¼Œæ²¡é”™ã€‚' }]},
            { lesson: 3, category: 'ç»ƒä¹  2', lines: [{ role: 'Q', gender: 'f', jp: 'ãƒˆã‚¤ãƒ¬ã¯ã€€ã©ã“ã§ã™ã‹ã€‚', cn: 'æ´—æ‰‹é—´åœ¨å“ªé‡Œï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã‚ãã“ã§ã™ã€‚', cn: 'â€¦åœ¨é‚£è¾¹ã€‚' }]},
            { lesson: 3, category: 'ç»ƒä¹  3', lines: [{ role: 'Q', gender: 'f', jp: 'å±±ç”°ã•ã‚“ã¯ã€€ã©ã“ã§ã™ã‹ã€‚', cn: 'å±±ç”°å…ˆç”Ÿåœ¨å“ªé‡Œï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ä¼šè­°å®¤ã§ã™ã€‚', cn: 'â€¦åœ¨ä¼šè®®å®¤ã€‚' }]},
            { lesson: 3, category: 'ç»ƒä¹  4', lines: [{ role: 'Q', gender: 'f', jp: '[ãŠ]å›½ã¯ã€€ã©ã¡ã‚‰ã§ã™ã‹ã€‚', cn: 'æ‚¨æ˜¯å“ªä¸ªå›½å®¶çš„ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã‚¢ãƒ¡ãƒªã‚«ã§ã™ã€‚', cn: 'â€¦æ˜¯ç¾å›½ã€‚' }]},
            { lesson: 3, category: 'ç»ƒä¹  5', lines: [{ role: 'Q', gender: 'm', jp: 'ãã‚Œã¯ã€€ã©ã“ã®ã€€é´ã§ã™ã‹ã€‚', cn: 'é‚£æ˜¯å“ªé‡Œçš„é‹å­ï¼Ÿ' }, { role: 'A', gender: 'f', jp: 'â€¦ã‚¤ã‚¿ãƒªã‚¢ã®ã€€é´ã§ã™ã€‚', cn: 'â€¦æ˜¯æ„å¤§åˆ©çš„é‹å­ã€‚' }]},
            { lesson: 3, category: 'ç»ƒä¹  6', lines: [{ role: 'Q', gender: 'f', jp: 'ã“ã®ã€€æ™‚è¨ˆã¯ã€€ã„ãã‚‰ã§ã™ã‹ã€‚', cn: 'è¿™å—æ‰‹è¡¨å¤šå°‘é’±ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦18,600å††ã§ã™ã€‚', cn: 'â€¦æ˜¯18,600æ—¥å…ƒã€‚' }]},
            { lesson: 3, category: 'ä¼šè¯ï¼šè¯·ç»™æˆ‘è¿™ä¸ª', lines: [{ role: 'ãƒãƒªã‚¢', gender: 'f', jp: 'ã™ã¿ã¾ã›ã‚“ã€‚ãƒ¯ã‚¤ãƒ³å£²ã‚Šå ´ã¯ã€€ã©ã“ã§ã™ã‹ã€‚', cn: 'æ‰“æ‰°ä¸€ä¸‹ã€‚è¯·é—®å–çº¢é…’çš„æŸœå°åœ¨å“ªé‡Œï¼Ÿ' }, { role: 'åº—å“¡', gender: 'm', jp: 'åœ°ä¸‹ï¼‘éšã§ã™ã€‚', cn: 'åœ¨åœ°ä¸‹1å±‚ã€‚' }, { role: 'ãƒãƒªã‚¢', gender: 'f', jp: 'ãã®ã€€ãƒ¯ã‚¤ãƒ³ã‚’ã€€è¦‹ã›ã¦ã€€ãã ã•ã„ã€‚', cn: 'è¯·è®©æˆ‘çœ‹çœ‹é‚£ç“¶çº¢é…’ã€‚' }, { role: 'ãƒãƒªã‚¢', gender: 'f', jp: 'ã“ã‚Œã¯ã€€ã©ã“ã®ã€€ãƒ¯ã‚¤ãƒ³ã§ã™ã‹ã€‚', cn: 'è¿™æ˜¯å“ªé‡Œçš„çº¢é…’ï¼Ÿ' }, { role: 'åº—å“¡', gender: 'm', jp: 'æ—¥æœ¬ã®ã§ã™ã€‚', cn: 'æ˜¯æ—¥æœ¬çš„ã€‚' }, { role: 'ãƒãƒªã‚¢', gender: 'f', jp: 'ã˜ã‚ƒã€ã“ã‚Œã‚’ã€€ãã ã•ã„ã€‚', cn: 'é‚£ä¹ˆï¼Œè¯·ç»™æˆ‘è¿™ç“¶ã€‚' }]},

            // === ç¬¬4è¯¾ ===
            { lesson: 4, category: 'ç»ƒä¹  1', lines: [{ role: 'Q', gender: 'f', jp: 'ä»Šã€€ä½•æ™‚ã§ã™ã‹ã€‚', cn: 'ç°åœ¨å‡ ç‚¹ï¼Ÿ' }, { role: 'A', gender: 'm', jp: '2æ™‚10åˆ†ã§ã™ã€‚', cn: '2ç‚¹10åˆ†ã€‚' }]},
            { lesson: 4, category: 'ç»ƒä¹  2', lines: [{ role: 'Q', gender: 'f', jp: 'ä¼‘ã¿ã¯ã€€ä½•æ›œæ—¥ã§ã™ã‹ã€‚', cn: 'ä¼‘æ¯æ—¥æ˜¯æ˜ŸæœŸå‡ ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'åœŸæ›œæ—¥ã¨ã€€æ—¥æ›œæ—¥ã§ã™ã€‚', cn: 'æ˜¯æ˜ŸæœŸå…­å’Œæ˜ŸæœŸæ—¥ã€‚' }]},
            { lesson: 4, category: 'ç»ƒä¹  3', lines: [{ role: 'Q', gender: 'f', jp: 'éŠ€è¡Œã¯ã€€ä½•æ™‚ã‹ã‚‰ã€€ä½•æ™‚ã¾ã§ã§ã™ã‹ã€‚', cn: 'é“¶è¡Œä»å‡ ç‚¹åˆ°å‡ ç‚¹è¥ä¸šï¼Ÿ' }, { role: 'A', gender: 'm', jp: '9æ™‚ã‹ã‚‰ã€€3æ™‚ã¾ã§ã§ã™ã€‚', cn: 'ä»9ç‚¹åˆ°3ç‚¹ã€‚' }]},
            { lesson: 4, category: 'ç»ƒä¹  4', lines: [{ role: 'Q', gender: 'f', jp: 'æ¯æ™©ã€€ä½•æ™‚ã«ã€€å¯ã¾ã™ã‹ã€‚', cn: 'æ¯æ™šå‡ ç‚¹ç¡è§‰ï¼Ÿ' }, { role: 'A', gender: 'm', jp: '11æ™‚ã«ã€€å¯ã¾ã™ã€‚', cn: '11ç‚¹ç¡è§‰ã€‚' }]},
            { lesson: 4, category: 'ç»ƒä¹  5', lines: [{ role: 'Q', gender: 'f', jp: 'åœŸæ›œæ—¥ã€€åƒãã¾ã™ã‹ã€‚', cn: 'æ˜ŸæœŸå…­å·¥ä½œå—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã„ã„ãˆã€åƒãã¾ã›ã‚“ã€‚', cn: 'â€¦ä¸ï¼Œä¸å·¥ä½œã€‚' }]},
            { lesson: 4, category: 'ç»ƒä¹  6', lines: [{ role: 'Q', gender: 'f', jp: 'ãã®ã†ã€€å‹‰å¼·ã—ã¾ã—ãŸã‹ã€‚', cn: 'æ˜¨å¤©å­¦ä¹ äº†å—ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã„ã„ãˆã€å‹‰å¼·ã—ã¾ã›ã‚“ã§ã—ãŸã€‚', cn: 'â€¦ä¸ï¼Œæ²¡å­¦ä¹ ã€‚' }]},
            { lesson: 4, category: 'ä¼šè¯ï¼šè¥ä¸šåˆ°å‡ ç‚¹', lines: [{ role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'ã™ã¿ã¾ã›ã‚“ã€‚ãã¡ã‚‰ã¯ã€€ä½•æ™‚ã¾ã§ã§ã™ã‹ã€‚', cn: 'è¯·é—®ï¼Œä½ ä»¬é‚£é‡Œè¥ä¸šåˆ°å‡ ç‚¹ï¼Ÿ' }, { role: 'åº—ã®äºº', gender: 'f', jp: '10æ™‚ã¾ã§ã§ã™ã€‚', cn: 'åˆ°10ç‚¹ã€‚' }, { role: 'ãƒŸãƒ©ãƒ¼', gender: 'm', jp: 'ä¼‘ã¿ã¯ã€€ä½•æ›œæ—¥ã§ã™ã‹ã€‚', cn: 'ä¼‘æ¯æ—¥æ˜¯æ˜ŸæœŸå‡ ï¼Ÿ' }, { role: 'åº—ã®äºº', gender: 'f', jp: 'æ—¥æ›œæ—¥ã§ã™ã€‚', cn: 'æ˜¯æ˜ŸæœŸå¤©ã€‚' }]},

            // === ç¬¬5è¯¾ ===
            { lesson: 5, category: 'ç»ƒä¹  1', lines: [{ role: 'Q', gender: 'f', jp: 'ã‚ã—ãŸã€€ã©ã“ã¸ã€€è¡Œãã¾ã™ã‹ã€‚', cn: 'æ˜å¤©å»å“ªé‡Œï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'å¥ˆè‰¯ã¸ã€€è¡Œãã¾ã™ã€‚', cn: 'å»å¥ˆè‰¯ã€‚' }]},
            { lesson: 5, category: 'ç»ƒä¹  2', lines: [{ role: 'Q', gender: 'f', jp: 'æ—¥æ›œæ—¥ã€€ã©ã“ã¸ã€€è¡Œãã¾ã—ãŸã‹ã€‚', cn: 'æ˜ŸæœŸå¤©å»äº†å“ªé‡Œï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'â€¦ã©ã“[ã¸]ã‚‚ã€€è¡Œãã¾ã›ã‚“ã§ã—ãŸã€‚', cn: 'â€¦å“ªé‡Œä¹Ÿæ²¡å»ã€‚' }]},
            { lesson: 5, category: 'ç»ƒä¹  3', lines: [{ role: 'Q', gender: 'f', jp: 'ä½•ã§ã€€æ±äº¬ã¸ã€€è¡Œãã¾ã™ã‹ã€‚', cn: 'æ€ä¹ˆå»ä¸œäº¬ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'æ–°å¹¹ç·šã§ã€€è¡Œãã¾ã™ã€‚', cn: 'åæ–°å¹²çº¿å»ã€‚' }]},
            { lesson: 5, category: 'ç»ƒä¹  4', lines: [{ role: 'Q', gender: 'f', jp: 'ã ã‚Œã¨ã€€æ±äº¬ã¸ã€€è¡Œãã¾ã™ã‹ã€‚', cn: 'å’Œè°ä¸€èµ·å»ä¸œäº¬ï¼Ÿ' }, { role: 'A', gender: 'm', jp: 'å±±ç”°ã•ã‚“ã¨ã€€è¡Œãã¾ã™ã€‚', cn: 'å’Œå±±ç”°å…ˆç”Ÿ/å¥³å£«ä¸€èµ·å»ã€‚' }]},
            { lesson: 5, category: 'ç»ƒä¹  5', lines: [{ role: 'Q', gender: 'f', jp: 'ã„ã¤ã€€æ—¥æœ¬ã¸ã€€æ¥ã¾ã—ãŸã‹ã€‚', cn: 'ä»€ä¹ˆæ—¶å€™æ¥çš„æ—¥æœ¬ï¼Ÿ' }, { role: 'A', gender: 'm', jp: '3æœˆ25æ—¥ã«ã€€æ¥ã¾ã—ãŸã€‚', cn: '3æœˆ25æ—¥æ¥çš„ã€‚' }]},
            { lesson: 5, category: 'ä¼šè¯ï¼šå»ç”²å­å›­å—', lines: [{ role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ã™ã¿ã¾ã›ã‚“ã€‚ç”²å­åœ’ã¾ã§ã€€ã„ãã‚‰ã§ã™ã‹ã€‚', cn: 'æ‰“æ‰°ä¸€ä¸‹ã€‚åˆ°ç”²å­å›­å¤šå°‘é’±ï¼Ÿ' }, { role: 'å¥³ã®äºº', gender: 'f', jp: '350å††ã§ã™ã€‚', cn: '350æ—¥å…ƒã€‚' }, { role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ç”²å­åœ’ã¯ã€€ä½•ç•ªç·šã§ã™ã‹ã€‚', cn: 'ç”²å­å›­åœ¨å‡ å·ç«™å°ï¼Ÿ' }, { role: 'é§…å“¡', gender: 'm', jp: '5ç•ªç·šã§ã™ã€‚', cn: '5å·ç«™å°ã€‚' }, { role: 'ã‚µãƒ³ãƒˆã‚¹', gender: 'm', jp: 'ã“ã®ã€€é›»è»Šã¯ã€€ç”²å­åœ’ã¸ã€€è¡Œãã¾ã™ã‹ã€‚', cn: 'è¿™è¶Ÿç”µè½¦å»ç”²å­å›­å—ï¼Ÿ' }, { role: 'ç”·ã®äºº', gender: 'm', jp: 'ã„ã„ãˆã€‚æ¬¡ã®ã€€ã€Œæ™®é€šã€ã§ã™ã‚ˆã€‚', cn: 'ä¸ã€‚ä¸‹ä¸€è¶Ÿâ€œæ™®é€šâ€åˆ—è½¦æ‰å»ã€‚' }]},
        ];

        // ================= é€»è¾‘å˜é‡ =================
        let activeData = [];
        let currentIndex = 0;
        let globalShowJp = false;
        let globalShowCn = false;
        let isSeqPlaying = false;
        let selectedLessons = [1, 2, 3, 4, 5];
        let voices = { male: null, female: null, default: null };

        // ================= åˆå§‹åŒ–ä¸ç­›é€‰ =================
        function init() {
            // é¦–æ¬¡åŠ è½½ï¼Œé»˜è®¤å…¨é€‰ï¼Œä¿æŒé¡ºåº
            filterData();
            loadVoices();
        }

        function toggleFilter(label, lessonNum) {
            const checkbox = label.querySelector('input');
            checkbox.checked = !checkbox.checked; // æ‰‹åŠ¨åˆ‡æ¢çŠ¶æ€ï¼Œå› ä¸ºinput hiddenäº†
            
            if (checkbox.checked) {
                label.classList.add('checked');
                if(!selectedLessons.includes(lessonNum)) selectedLessons.push(lessonNum);
            } else {
                label.classList.remove('checked');
                selectedLessons = selectedLessons.filter(l => l !== lessonNum);
            }
            selectedLessons.sort((a,b) => a-b);
            
            // é‡æ–°ç”Ÿæˆæ•°æ®æ± ï¼Œé»˜è®¤ä¸æ‰“ä¹±ï¼Œé‡ç½®åˆ°ç¬¬ä¸€å¼ 
            filterData();
        }

        function filterData(shuffle = false) {
            // 1. ç­›é€‰
            let temp = rawData.filter(item => selectedLessons.includes(item.lesson));
            
            // 2. ä¹±åº (å¦‚æœéœ€è¦)
            if (shuffle) {
                for (let i = temp.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [temp[i], temp[j]] = [temp[j], temp[i]];
                }
            }

            activeData = temp;
            currentIndex = 0;
            render();
        }

        function shuffleAndReset() {
            filterData(true);
            // è§†è§‰åé¦ˆ
            const btn = document.querySelector('.btn-blue');
            const originalText = btn.innerText;
            btn.innerText = "âœ… å·²æ‰“ä¹±";
            setTimeout(() => btn.innerText = originalText, 1000);
        }

        // ================= è¯­éŸ³å¼•æ“ =================
        function loadVoices() {
            const all = window.speechSynthesis.getVoices();
            const ja = all.filter(v => v.lang.includes('ja'));
            if (ja.length > 0) {
                voices.female = ja.find(v => v.name.includes('Kyoko') || v.name.includes('Female')) || ja[0];
                voices.male = ja.find(v => v.name.includes('Otoya') || v.name.includes('Male')) || ja[0];
                voices.default = ja[0];
                document.getElementById('status-bar').innerText = "âœ… è¯­éŸ³åŠ è½½å®Œæˆ";
            }
        }
        if (window.speechSynthesis.onvoiceschanged !== undefined) window.speechSynthesis.onvoiceschanged = loadVoices;

        function speak(text, gender, callback) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP';
            u.rate = 0.9;
            
            if (gender === 'm' && voices.male) u.voice = voices.male;
            else if (gender === 'f' && voices.female) u.voice = voices.female;
            else if (voices.default) u.voice = voices.default;

            u.pitch = (gender === 'm') ? 0.95 : 1.05;
            if (callback) u.onend = callback;
            window.speechSynthesis.speak(u);
        }

        // ================= æ¸²æŸ“é€»è¾‘ =================
        function render() {
            window.speechSynthesis.cancel();
            isSeqPlaying = false;
            
            const cardArea = document.getElementById('cardArea');
            const pageTitle = document.getElementById('pageTitle');

            if (activeData.length === 0) {
                cardArea.innerHTML = `<div class="empty-tip">è¯·è‡³å°‘é€‰æ‹©ä¸€è¯¾</div>`;
                pageTitle.innerText = "æœªé€‰æ‹©è¯¾ç¨‹";
                return;
            }
            
            const data = activeData[currentIndex];
            pageTitle.innerText = `è¿›åº¦: ${currentIndex + 1} / ${activeData.length}`;
            
            updateGlobalBtns();

            let html = `
                <div class="lesson-badge">ç¬¬${data.lesson}è¯¾</div>
                <div class="tag">${data.category}</div>
                <button class="btn-green" onclick="playSequence()">â–¶ï¸ å®Œæ•´æ’­æ”¾ (åŒ…å«åœé¡¿)</button>
                <div style="text-align:left; width:100%;">
            `;

            data.lines.forEach((line, idx) => {
                const jpClass = globalShowJp ? 'text-block jp-text' : 'text-block jp-text masked';
                const cnClass = globalShowCn ? 'text-block cn-text' : 'text-block cn-text masked';
                let roleClass = line.gender === 'm' ? 'role-m' : 'role-f';
                
                html += `
                    <div class="dialogue-row" id="row-${idx}">
                        <div class="play-col"><div class="play-icon" onclick="playLine(${idx})">ğŸ”Š</div></div>
                        <div class="text-col">
                            ${line.role ? `<span class="role-tag ${roleClass}">${line.role}</span>` : ''}
                            <div class="${jpClass}" onclick="toggleOne(this)">${line.jp}</div>
                            <div class="${cnClass}" onclick="toggleOne(this)">${line.cn}</div>
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            cardArea.innerHTML = html;
        }

        // ================= äº¤äº’é€»è¾‘ =================
        function toggleOne(el) { 
            if(el.classList.contains('masked')) el.classList.remove('masked');
            else el.classList.add('masked');
        }
        function toggleGlobal(type) { 
            if (type === 'jp') globalShowJp = !globalShowJp; 
            if (type === 'cn') globalShowCn = !globalShowCn; 
            render(); 
        }
        function updateGlobalBtns() {
            const bJ = document.getElementById('btnJp'); const bC = document.getElementById('btnCn');
            bJ.className = globalShowJp ? 'btn-toggle active' : 'btn-toggle'; bC.className = globalShowCn ? 'btn-toggle active' : 'btn-toggle';
            bJ.innerText = globalShowJp ? 'å…¨æ˜¾æ—¥æ–‡' : 'å…¨éšæ—¥æ–‡'; bC.innerText = globalShowCn ? 'å…¨æ˜¾ä¸­æ–‡' : 'å…¨éšä¸­æ–‡';
        }
        function playLine(idx) {
            isSeqPlaying = false; highlightRow(idx);
            const data = activeData[currentIndex]; const line = data.lines[idx];
            speak(line.jp, line.gender, () => { unhighlightRow(idx); });
        }
        function playSequence() {
            isSeqPlaying = true; const data = activeData[currentIndex]; let idx = 0;
            document.querySelectorAll('.dialogue-row').forEach(e => e.classList.remove('playing-row'));
            function next() {
                if (!isSeqPlaying || idx >= data.lines.length) { isSeqPlaying = false; if(idx > 0) unhighlightRow(idx-1); return; }
                if (idx > 0) unhighlightRow(idx-1); highlightRow(idx);
                document.getElementById(`row-${idx}`).scrollIntoView({behavior: "smooth", block: "center"});
                const line = data.lines[idx];
                speak(line.jp, line.gender, () => { idx++; setTimeout(next, 600); });
            }
            next();
        }
        function highlightRow(idx) { const el = document.getElementById(`row-${idx}`); if (el) el.classList.add('playing-row'); }
        function unhighlightRow(idx) { const el = document.getElementById(`row-${idx}`); if (el) el.classList.remove('playing-row'); }
        function changeCard(dir) { 
            const next = currentIndex + dir; 
            if (next >= 0 && next < activeData.length) { currentIndex = next; render(); } 
        }

        // å¯åŠ¨
        setTimeout(init, 100);
    </script>
</body>
</html>
